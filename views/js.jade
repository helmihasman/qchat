// jQuery
script(src='../../../gentelella/vendors/jquery/dist/jquery.min.js')
// Bootstrap
script(src='../../../gentelella/vendors/bootstrap/dist/js/bootstrap.min.js')
// FastClick
script(src='../../../gentelella/vendors/fastclick/lib/fastclick.js')
// NProgress
script(src='../../../gentelella/vendors/nprogress/nprogress.js')
// Chart.js
script(src='../../../gentelella/vendors/Chart.js/dist/Chart.min.js')
// gauge.js
script(src='../../../gentelella/vendors/bernii/gauge.js/dist/gauge.min.js')
// bootstrap-progressbar
script(src='../../../gentelella/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js')
// iCheck
script(src='../../../gentelella/vendors/iCheck/icheck.min.js')
// Skycons
script(src='../../../gentelella/vendors/skycons/skycons.js')
// Flot
script(src='../../../gentelella/vendors/Flot/jquery.flot.js')
script(src='../../../gentelella/vendors/Flot/jquery.flot.pie.js')
script(src='../../../gentelella/vendors/Flot/jquery.flot.time.js')
script(src='../../../gentelella/vendors/Flot/jquery.flot.stack.js')
script(src='../../../gentelella/vendors/Flot/jquery.flot.resize.js')
// Flot plugins
script(src='../../../gentelella/js/flot/jquery.flot.orderBars.js')
script(src='../../../gentelella/js/flot/date.js')
script(src='../../../gentelella/js/flot/jquery.flot.spline.js')
script(src='../../../gentelella/js/flot/curvedLines.js')
// jVectorMap
script(src='../../../gentelella/js/maps/jquery-jvectormap-2.0.3.min.js')
// bootstrap-daterangepicker
script(src='../../../gentelella/js/moment/moment.min.js')
script(src='../../../gentelella/js/datepicker/daterangepicker.js')
// Custom Theme Scripts
script(src='../../../gentelella/build/js/custom.min.js')
// Datatables
script(src='../../../gentelella/vendors/datatables.net/js/jquery.dataTables.min.js')
script(src='../../../gentelella/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js')
script(src='../../../gentelella/vendors/datatables.net-buttons/js/dataTables.buttons.min.js')
script(src='../../../gentelella/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js')
script(src='../../../gentelella/vendors/datatables.net-buttons/js/buttons.flash.min.js')
script(src='../../../gentelella/vendors/datatables.net-buttons/js/buttons.html5.min.js')
script(src='../../../gentelella/vendors/datatables.net-buttons/js/buttons.print.min.js')
script(src='../../../gentelella/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js')
script(src='../../../gentelella/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js')
script(src='../../../gentelella/vendors/datatables.net-responsive/js/dataTables.responsive.min.js')
script(src='../../../gentelella/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js')
script(src='../../../gentelella/vendors/datatables.net-scroller/js/datatables.scroller.min.js')
script(src='../../../gentelella/vendors/jszip/dist/jszip.min.js')
script(src='../../../gentelella/vendors/pdfmake/build/pdfmake.min.js')
script(src='../../../gentelella/vendors/pdfmake/build/vfs_fonts.js')

script(src='../../../javascripts/MovingMarker.js')

script(src='../../../javascripts/bootstrap-treeview.js')

script(type='text/javascript',src='/socket.io/socket.io.js')

//date range picker
script(src='https://cdn.jsdelivr.net/momentjs/2.14.1/moment.min.js')
script(src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js')
link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/css/bootstrap-datetimepicker.min.css')



script(src='gentelella/vendors/ion.rangeSlider/js/ion.rangeSlider.min.js')

script(type='text/javascript').
  function goBack() {
    window.history.back();
    }
    
script(type='text/javascript').
  function goHome() {
    window.location.href = '/tracking';
    }
    
script(type='text/javascript').
  function select_month(selectObject) {
    $("#att_btn").click();
    }
    
script(type='text/javascript').
    function getTree(){
        var tree = [
            {
              text: "Parent 1",
              state: {
                selected: true
              },
              nodes: [
                {
                  text: "Child 1",
                  nodes: [
                    {
                      text: "Granhod 1"
                      
                       
                    },
                    {
                      text: "Grandchild 2"
                    }
                  ]
                },
                {
                  text: "Child 2"
                }
              ]
            },
            {
              text: "Parent 2"
              
            },
            {
              text: "Parent 3"
            },
            {
              text: "Parent 4"
            },
            {
              text: "Parent 5"
            }
          ];
          
    var data = "#{sidelist}".replace(/&quot;/g, '"');
    var jsontree = JSON.parse(data);
    return jsontree;
    }
    $('#tree').treeview({
        data: getTree(),
        onNodeChecked: function(event, node) {
            
            /*if(node.type == 'employee'){
            var partsOfStr = node.emp_gps.split(',');
            var newgps = new google.maps.LatLng(parseFloat(partsOfStr[1] - 0.00575), parseFloat(partsOfStr[0] - 0.00668))
            map_g.setZoom(10);
            map_g.setCenter(newgps);
            }
            else if(node.type == 'building'){
                var mystring = node.building_gps.replace('(','');
                mystring = mystring.replace(')','');
                var partsOfStr = mystring.split(',');
                var newgps = new google.maps.LatLng(parseFloat(partsOfStr[0] - 0.00575), parseFloat(partsOfStr[1] - 0.00668))
                map_g.setZoom(10);
                map_g.setCenter(newgps);
            }
            //alert(node.emp_gps+" is checked");
            $('#tree').treeview('uncheckNode', [ nodeId, { silent: true } ]);*/
          },
          onNodeUnchecked: function (event, node) {
            //alert(node.emp_id+" is unchecked");
          },
           onNodeSelected: function(event, data) {
            // Your logic goes here
            if(data.type == 'employee'){
            var partsOfStr = data.emp_gps.split(',');
            //var newgps = new google.maps.LatLng(parseFloat(partsOfStr[1] - 0.00575), parseFloat(partsOfStr[0] - 0.00668))
            
            //map_g.setZoom(10);
            //map_g.setCenter(newgps);

            map_baidu.panTo(new BMap.Point(parseFloat(partsOfStr[0]- 0.00668), parseFloat(partsOfStr[1]- 0.00575)));
            }
            else if(data.type == 'building'){
                var mystring = data.building_gps.replace('(','');
                mystring = mystring.replace(')','');
                var partsOfStr = mystring.split(',');
                //var newgps = new google.maps.LatLng(parseFloat(partsOfStr[0] - 0.00575), parseFloat(partsOfStr[1] - 0.00668))
                //map_g.setZoom(10);
                //map_g.setCenter(newgps);
                
                map_baidu.panTo(new BMap.Point(parseFloat(partsOfStr[1]), parseFloat(partsOfStr[0])));
            }
            }
    });
    
    $('#tree_outdoor').treeview({
        data: getTree(),
        onNodeSelected: function(event, data) {
            
            //alert(node.emp_gps+" is checked");
            
          },
          onNodeUnchecked: function (event, node) {
            //alert(node.emp_id+" is unchecked");
          }
    });
    
script(type='text/javascript').
    function getTreeIndoor(){
     
    var data = "#{sidelist}".replace(/&quot;/g, '"');
    var jsontree = JSON.parse(data);
    return jsontree;
    }
    $('#tree_indoor').treeview({
        data: getTreeIndoor(),
        onNodeSelected: function(event, data) {

            //alert(node.emp_gps+" is checked");
           
          },
          onNodeUnchecked: function (event, node) {
            //alert(node.emp_id+" is unchecked");
          }
    });
    $('#tree_indoor_playback').treeview({
        data: getTreeIndoor(),
        onNodeSelected: function(event, data) {

            //alert(node.emp_gps+" is checked");
           
          },
          onNodeUnchecked: function (event, node) {
            //alert(node.emp_id+" is unchecked");
          }
    });
    
    
  

script.
 $(document).ready(function() {
     $('#datatable').DataTable( {
        "language": {
            "processing":   "處理中...",
            "loadingRecords": "載入中...",
            "lengthMenu": "顯示 _MENU_ 項結果",
            "zeroRecords": "沒有符合的結果",
            "info": "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
            "infoEmpty": "顯示第 0 至 0 項結果，共 0 項",
            "infoFiltered": "(從 _MAX_ 項結果中過濾)",
            "infoPostFix":  "",
            "search":       "搜尋:",
            "paginate": {
                "first":    "第一頁",
                "previous": "上一頁",
                "next":     "下一頁",
                "last":     "最後一頁"
            },
            "aria": {
                "sortAscending":  ": 升冪排列",
                "sortDescending": ": 降冪排列"
            }
        }
    } );
    } );
 $(document).ready(function() {
     $('#datatable2').DataTable( {
        "language": {
            "processing":   "處理中...",
            "loadingRecords": "載入中...",
            "lengthMenu": "顯示 _MENU_ 項結果",
            "zeroRecords": "沒有符合的結果",
            "info": "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
            "infoEmpty": "顯示第 0 至 0 項結果，共 0 項",
            "infoFiltered": "(從 _MAX_ 項結果中過濾)",
            "infoPostFix":  "",
            "search":       "搜尋:",
            "paginate": {
                "first":    "第一頁",
                "previous": "上一頁",
                "next":     "下一頁",
                "last":     "最後一頁"
            },
            "aria": {
                "sortAscending":  ": 升冪排列",
                "sortDescending": ": 降冪排列"
            }
        }
    } );
    } );
    
script.
  $(function () {
  $('#datetimepicker1').datetimepicker({format: 'YYYY-MM-DD HH:mm'});
  });
  $(function () {
  $('#datetimepicker2').datetimepicker({format: 'YYYY-MM-DD HH:mm'});
  });



script.
 function simcard_bind(){
    document.getElementById("sim_card").readOnly = false;
    document.getElementById("simcard_bind").style.display = "none";
 }
script.
 function email_bind(){
    document.getElementById("email").readOnly = false;
    document.getElementById("email_bind").style.display = "none";
 }
 
script.
    function notify_click(){
    document.getElementById("notification-badge").style.display = "none";
    }
    
    
// Ion.RangeSlider
script.
  $(document).ready(function() {
    
    $("#range_31").ionRangeSlider({
        type: "double",
        min: 0,
        max: 100,
        from: 30,
        to: 70,
        from_fixed: true
    });

  });
// /Ion.RangeSlider
// Bootstrap Colorpicker
     
script(src='http://maps.google.cn/maps/api/js?key=AIzaSyDdtF6BnY-mKqQmaOIyLVy-rrCI_jJGkDs&libraries=places&callback=companyMap', async='', defer='')

script.
    var companyMap = function() {
    
        var map_company = new BMap.Map("googleMapCompany");            
        map_company.centerAndZoom(new BMap.Point(112.9469622, 23.1253491), 11);         
        //单击获取点击的经纬度
        map_company.addEventListener("click",function(e){
            
            var location = "("+e.point.lat + "," + e.point.lng+")";
            $("#location").val(location);
            //alert(e.point.lat + "," + e.point.lng);
        });  
    //if (navigator.geolocation) {
        //navigator.geolocation.getCurrentPosition(function(position) {

            /*map_g = new google.maps.Map(document.getElementById('googleMapCompany'), {
                center: {
                    //lat: position.coords.latitude,
                    //lng: position.coords.longitude
                    lat: 23.1253491,
                    lng: 112.9469622
                },
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: false
            });
            
            var marker;
            function placeMarker(location) {
              if ( marker ) {
                marker.setPosition(location);
              } else {
                marker = new google.maps.Marker({
                  position: location,
                  map: map_g
                });
              }

              $("#location").val(location);

            }
            google.maps.event.addListener(map_g, 'click', function(event) {
              placeMarker(event.latLng);
            });
            
            // Create the search box and link it to the UI element.
        var input = document.getElementById('pac-input');
        var searchBox = new google.maps.places.SearchBox(input);
        map_g.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        // Bias the SearchBox results towards current map's viewport.
        map_g.addListener('bounds_changed', function() {
          searchBox.setBounds(map_g.getBounds());
        });

        var markers = [];
        // Listen for the event fired when the user selects a prediction and retrieve
        // more details for that place.
        searchBox.addListener('places_changed', function() {
          var places = searchBox.getPlaces();

          if (places.length == 0) {
            return;
          }

          // Clear out the old markers.
          markers.forEach(function(marker) {
            marker.setMap(null);
          });
          markers = [];

          // For each place, get the icon, name and location.
          var bounds = new google.maps.LatLngBounds();
          places.forEach(function(place) {
            if (!place.geometry) {
              console.log("Returned place contains no geometry");
              return;
            }
            var icon = {
              url: place.icon,
              size: new google.maps.Size(71, 71),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(17, 34),
              scaledSize: new google.maps.Size(25, 25)
            };

            // Create a marker for each place.
            markers.push(new google.maps.Marker({
              map: map_g,
              icon: icon,
              title: place.name,
              position: place.geometry.location
            }));

            if (place.geometry.viewport) {
              // Only geocodes have viewport.
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
          });
          map_g.fitBounds(bounds);
        }); */

    //}
    };
    


    
script.
    var car; //Car icon
    var label; //Information label
    var centerPoint;
    var flightPlanCoordinates = [];


    var timer; //Timer
    var index = 0; //Recording and playing to the first few point
    var marker_g = [];
    var infowindow = [];
    var contentString = [];
    var trackingMap = function() {
       
    //if (navigator.geolocation) {
        //navigator.geolocation.getCurrentPosition(function(position) {
            var data = "#{data}".replace(/&quot;/g, '"');
            var company = "#{company}".replace(/&quot;/g, '"');
            data_p = JSON.parse(data);
            //comp_p = JSON.parse(company);
            //var mystring = comp_p[0].company_location.replace('(','');
            comp_p = JSON.parse(company);
            
            /*map_g = new google.maps.Map(document.getElementById('googleMapTracking'), {
                center: {
                    //lat: position.coords.latitude,
                    //lng: position.coords.longitude
                    lat: 23.1253491,
                    lng: 112.9469622
                },
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: false
            });*/
                
            //baidu
            map_baidu = new BMap.Map("allmap");    // 创建Map实例
            map_baidu.centerAndZoom(new BMap.Point(112.9469622, 23.1253491), 11);  // 初始化地图,设置中心点坐标和地图级别
            //添加地图类型控件
            map_baidu.addControl(new BMap.MapTypeControl({
            mapTypes:[
            BMAP_NORMAL_MAP,
            BMAP_HYBRID_MAP
            ]}));
            map_baidu.setCurrentCity("北京");          // 设置地图显示的城市 此项是必须设置的
            map_baidu.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放    
            
            var infowindow2 = new google.maps.InfoWindow({
                    content: contentString,
                    maxWidth: 320 
                  });
            var infoWindow = new google.maps.InfoWindow({maxWidth: 250});
            
            var marker_b = [];
            var contentString2 = [];
            
            for(var pp=0;pp<comp_p.length;pp++){
                var mystring = comp_p[pp].building_location.replace('(','');
                mystring = mystring.replace(')','');
                var splitstr = mystring.split(',');
                var latt,lonn;


                if(splitstr[0] === ''){
                    latt = 23.1253491;
                }
                else{
                    latt = parseFloat(splitstr[0]);
                }
                if(splitstr[1] === '' || splitstr[1] === undefined || splitstr[1] === 'undefined'){
                    lonn = 112.9469622;
                }
                else{
                    lonn = parseFloat(splitstr[1]);
                }

                
                    contentString2[pp] = [parseFloat(splitstr[1]),parseFloat(splitstr[0]),'<ul class="list-unstyled">'+
                            '<li class="media event">'+
                                '<a class="pull-left border-aero profile_thumb">'+
                                  '<i class="fa fa-building aero"></i>'+
                                '</a>'+
                                '<div class="media-body">'+
                                  '<a class="title" href="#">'+comp_p[pp].building_name+'</a>'+
                                  '<p><b>地址:</b> '+comp_p[pp].building_add+'</p>'+
                                  '<br><a href="/tracking_indoor/'+comp_p[pp].building_id+'" class="btn btn-success btn-sm">显示详细资料</a>'+
                                '</div>'+
                              '</li></ul>',comp_p[pp].building_name];
            }
            
            
            for(var i=0;i<contentString2.length;i++){
                var myIcon = new BMap.Icon("/images/skyline.png", new BMap.Size(50,50));
                var marker = new BMap.Marker(new BMap.Point(contentString2[i][0],contentString2[i][1]),{icon:myIcon});  // 创建标注
                var content = contentString2[i][2];
                var label = new BMap.Label(contentString2[i][3],{offset:new BMap.Size(20,10)});
                label.setStyle({ borderColor: "#999", border:"0" });
                map_baidu.addOverlay(marker);           // 将标注添加到地图中
                marker.setLabel(label);
                addClickHandler(content,marker);
            }
            
            function addClickHandler(content,marker){
                    marker.addEventListener("click",function(e){
                            
                            openInfo(content,e);}
                    );
            }
            function openInfo(content,e){
                    var p = e.target;
                    var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                    var infoWindow = new BMap.InfoWindow(content);  // 创建信息窗口对象 
                    map_baidu.openInfoWindow(infoWindow,point); //开启信息窗口
            }
            
            var contentString = [];
            for(var i=0;i<data_p.length;i++){
                var d = new Date(data_p[i].employee_time);
            //    d.setMinutes(d.getMinutes()+480);
                //d.setMinutes(d.getMinutes()+480);
                var ddate = d.getDate();
                var dmonth = d.getMonth()+1;
                var dyear = d.getFullYear();
                var dhour = d.getHours();
                var dminutes = d.getMinutes();
                var dseconds = d.getSeconds();


                if(ddate < 10){
                    ddate = "0"+ddate;
                }
                if(dmonth < 10){
                    dmonth = "0"+dmonth;
                }

                if(dhour < 10){
                    dhour = "0"+dhour;
                }
                if(dminutes < 10){
                    dminutes = "0"+dminutes;
                }
                if(dseconds < 10){
                    dseconds = "0"+dseconds;
                }

                var newdate;
                newdate = dyear+"-"+dmonth+"-"+ddate+" "+dhour+":"+dminutes+":"+dseconds;
                var partsOfStr = data_p[i].employee_gps.split(',');
                //alert(partsOfStr);
                contentString[i] =[parseFloat(partsOfStr[0] - 0.00668),parseFloat(partsOfStr[1] - 0.00575),'<ul class="list-unstyled">'+
                        '<li class="media event">'+
                            '<a class="pull-left">'+
                              '<img src="/'+data_p[i].employee_image+'" height="40" width="40">'+
                            '</a>'+
                            '<div class="media-body">'+
                              '<a class="title" href="#">'+data_p[i].employee_name+'</a>'+
                              '<p>最后的位置: '+newdate+'</p>'+
                              '</p>'+
                            '</div>'+
                          '</li></ul>',data_p[i].employee_name];
                
                var myLatLng = {lat: parseFloat(partsOfStr[1] - 0.00575), lng: parseFloat(partsOfStr[0] - 0.00668)};
                //alert(myLatLng);
               /* marker_g[i] = new google.maps.Marker({
                    position: myLatLng,
                    icon: '/images/man2_1.png',
                    map: map_g,
                    label: data_p[i].employee_name
                    });

                   google.maps.event.addListener(marker_g[i], 'click', (function(marker, i) {
                    return function() {
                        infoWindow.setContent(contentString[i]);
                        infoWindow.open(map_g, marker_g[i]);
                    }
                })(marker_g[i], i));
                
                marker_g[i].setMap(map_g); */
            }
            
            for(var i=0;i<contentString.length;i++){
                var myIcon = new BMap.Icon("/images/man2_1.png", new BMap.Size(50,50));
                var marker = new BMap.Marker(new BMap.Point(contentString[i][0],contentString[i][1]),{icon:myIcon});  // 创建标注
                var content = contentString[i][2];
                var label = new BMap.Label(contentString[i][3],{offset:new BMap.Size(20,10)});
                label.setStyle({ borderColor: "#999", border:"0" });
                map_baidu.addOverlay(marker);           // 将标注添加到地图中
                marker.setLabel(label);
                addClickHandler2(content,marker);
            }
            
            function addClickHandler2(content,marker){
                    marker.addEventListener("click",function(e){
                            
                            openInfo2(content,e);}
                    );
            }
            function openInfo2(content,e){
                    var p = e.target;
                    var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                    var infoWindow = new BMap.InfoWindow(content);  // 创建信息窗口对象 
                    map_baidu.openInfoWindow(infoWindow,point); //开启信息窗口
            }
        };
    
script.
    var marker_g = [];
    var infowindow = [];
    var contentString = [];
    var playbackMap = function() {
       
    
            var data = "#{data}".replace(/&quot;/g, '"');
            var company = "#{company}".replace(/&quot;/g, '"');
            data_p = JSON.parse(data);
            //comp_p = JSON.parse(company);
            //var mystring = comp_p[0].company_location.replace('(','');
            comp_p = JSON.parse(company);
            
            //baidu
            map_baidu = new BMap.Map("allmap_playback");    // 创建Map实例
            map_baidu.centerAndZoom(new BMap.Point(112.9469622, 23.1253491), 11);  // 初始化地图,设置中心点坐标和地图级别
            //添加地图类型控件
            map_baidu.addControl(new BMap.MapTypeControl({
            mapTypes:[
            BMAP_NORMAL_MAP,
            BMAP_HYBRID_MAP
            ]}));
            map_baidu.setCurrentCity("北京");          // 设置地图显示的城市 此项是必须设置的
            map_baidu.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放    
            
            /*map_g = new google.maps.Map(document.getElementById('googleMapPlayback'), {
                center: {
                    //lat: position.coords.latitude,
                    //lng: position.coords.longitude
                    lat: 23.1253491,
                    lng: 112.9469622
                },
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: false
            });*/
            
            var infowindow2 = new google.maps.InfoWindow({
                    content: contentString,
                    maxWidth: 320 
                  });
            var infoWindow = new google.maps.InfoWindow({maxWidth: 250});
            
            var marker_b = [];
            var contentString2 = [];
            
            for(var pp=0;pp<comp_p.length;pp++){
            var mystring = comp_p[pp].building_location.replace('(','');
            mystring = mystring.replace(')','');
            var splitstr = mystring.split(',');
            var latt,lonn;
            
            
            if(splitstr[0] === ''){
                latt = 23.1253491;
            }
            else{
                latt = parseFloat(splitstr[0]);
            }
            if(splitstr[1] === '' || splitstr[1] === undefined || splitstr[1] === 'undefined'){
                lonn = 112.9469622;
            }
            else{
                lonn = parseFloat(splitstr[1]);
            }

                contentString2[pp] = '<ul class="list-unstyled">'+
                        '<li class="media event">'+
                            '<a class="pull-left border-aero profile_thumb">'+
                              '<i class="fa fa-building aero"></i>'+
                            '</a>'+
                            '<div class="media-body">'+
                              '<a class="title" href="#">'+comp_p[pp].building_name+'</a>'+
                              '<p><b>地址:</b> '+comp_p[pp].building_add+'</p>'+
                            '</div>'+
                          '</li></ul>';
                
                var myLatLng = {lat: parseFloat(splitstr[0] - 0.00575), lng: parseFloat(splitstr[1] - 0.00668)};
                /*marker_b[pp] = new google.maps.Marker({
                    position: myLatLng,
                    icon: '/images/skyline.png',
                    map: map_g,
                    label: comp_p[pp].building_name
                    });
                    
                    google.maps.event.addListener(marker_b[pp], 'click', (function(marker, pp) {
                    return function() {
                        infoWindow.setContent(contentString2[pp]);
                        infoWindow.open(map_g, marker_b[pp]);
                    }
                })(marker_b[pp], pp));
               
                marker_b[pp].setMap(map_g); */
                    
             //baidu
                var pt = new BMap.Point(parseFloat(splitstr[1] - 0.00668), parseFloat(splitstr[0] - 0.00575));
                var myIcon = new BMap.Icon("/images/skyline.png", new BMap.Size(300,157));
                var marker2 = new BMap.Marker(pt,{icon:myIcon});  // 创建标注
                map_baidu.addOverlay(marker2); 
                var label = new BMap.Label(comp_p[pp].building_name,{offset:new BMap.Size(20,10)});
                label.setStyle({ borderColor: "#999", border:"0" });
                marker2.setLabel(label);
            }

        //});

    //}
    };

script.
    var showMaps = function() {
        
    //if (navigator.geolocation) {
        //navigator.geolocation.getCurrentPosition(function(position) {

            map_k = new google.maps.Map(document.getElementById('googleMapArea'), {
                center: {
                    //lat: position.coords.latitude,
                    //lng: position.coords.longitude
                    lat: 23.1253491,
                    lng: 112.9469622
                },
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: false
            });
            
            
            //map_k.data.setControls(['Polygon']);
            
            bindDataLayerListeners(map_k.data);
            
            loadPolygons();  //load saved data
            
            function bindDataLayerListeners(dataLayer) {
                dataLayer.addListener('addfeature', savePolygon);
                dataLayer.addListener('removefeature', savePolygon);
                //dataLayer.addListener('setgeometry', savePolygon);
            }

            

        //});
        function loadPolygons() {
                //var data = JSON.parse(localStorage.getItem('geoData'));
                data = JSON.parse(document.getElementById("map_string_load").value) ;
                //alert("llll-- "+JSON.stringify(data));
                map_g.data.forEach(function (f) {
                    map_g.data.remove(f);
                });
                map_g.data.addGeoJson(data);
            }

        function savePolygon() {
                //console.log("mapp11-- "+map.data);
                //alert("save polygon1");
                //var polyname = prompt("Enter polygon name:", "");
                 var coord;
                 var features = [];
                 //map.bindPopup("<div>This is a polygon</div>" + polygonPopUpButtons);
                map_k.data.toGeoJson(function (json) {
                    //alert("save name here");
                    //json.features[0].geometry.polyname = "testname";
                    //localStorage.setItem('geoData', JSON.stringify(json));
                    for (var i = 0; i < json.features.length; i++) {
                        console.log(json.features[i].geometry.coordinates);
                        coord = json.features[i].geometry.coordinates;
                        features.push({"type":"Feature","geometry":{"type":"Polygon","coordinates":coord,"polyname":"Area "+(i+1)},"properties":{}});
                    }
                    
                    var jsonstring = {"type":"FeatureCollection","features":features};
                    console.log("jsonstring-- "+JSON.stringify(jsonstring));
                    localStorage.setItem('geoData', JSON.stringify(jsonstring));
                    
                    initControls(jsonstring);
                    alert("save polygon2");
                });
            }
            
        function initControls(data)
            {
                var sel = document.getElementById('polyList');
                sel.options.length = 0;
                alert("savepolygon22-- "+JSON.stringify(data));

                for (var i = 0; i < data.features.length; i++) {
                    var opt = document.createElement('option');
                    opt.innerHTML = data.features[i].geometry.polyname;
                    opt.value = i;
                    sel.appendChild(opt);
                }

                document.getElementById("btnDelete").disabled = (data.features.length === 0); 
                document.getElementById("btnDelete").onclick = function(){
                    var selIdx = sel.options[sel.selectedIndex].value; //get poly index 
                    data.features.splice(parseInt(selIdx), 1);   

                    //reload 
                    localStorage.setItem('geoData', JSON.stringify(data));
                    initControls(data);
                    loadPolygons(map_k);   
                };
            }

    //}
    };

script.
    var runMaps2 = function() {
    //if (navigator.geolocation) {
        //navigator.geolocation.getCurrentPosition(function(position) {
            var data;
            map_g = new google.maps.Map(document.getElementById('googleMapArea'), {
                center: {
                    //lat: position.coords.latitude,
                    //lng: position.coords.longitude
                    lat: 23.1253491,
                    lng: 112.9469622
                },
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: false
            });
            
            
            //map_g.data.setControls(['Polygon']);
            
            bindDataLayerListeners(map_g.data);
            
            loadPolygons();  //load saved data
            
            function bindDataLayerListeners(dataLayer) {
                dataLayer.addListener('addfeature', savePolygon);
                dataLayer.addListener('removefeature', savePolygon);
                //dataLayer.addListener('setgeometry', savePolygon);
            }

            

        //});
        function loadPolygons() {
                //var data = JSON.parse(localStorage.getItem('geoData'));
                data = JSON.parse(document.getElementById("map_string_load").value) ;
                //alert("llll-- "+JSON.stringify(data));
                map_g.data.forEach(function (f) {
                    map_g.data.remove(f);
                });
                map_g.data.addGeoJson(data);
            }

            function savePolygon() {
                //alert("mapp11-- "+map_g.data);
                
                //var polyname = prompt("Enter polygon name:", "");
                 var coord;
                 var features = [];
                 var polyname;
                
                 /*if(data !== undefined){
                    for (var i = 0; i < data.features.length; i++) {
                        alert("--------1 "+JSON.stringify(data.features[i].geometry));
                        //alert("-------- "+json.features[i].geometry.coordinates);
                        //polyname = data.features[i].geometry.polyname;
                        
                        polyname = data.features[i].geometry.polyname;
                        
                        coord = data.features[i].geometry.coordinates;
                        features.push({"type":"Feature","geometry":{"type":"Polygon","coordinates":coord,"polyname":polyname},"properties":{}});
                    }
                }*/
                 //map.bindPopup("<div>This is a polygon</div>" + polygonPopUpButtons);
                map_g.data.toGeoJson(function (json) {
                    //alert("sjon -- "+JSON.stringify(json));
                    //alert("sdata -- "+JSON.stringify(data));
                    //alert("sjon -- "+JSON.stringify(data));
                    //json.features[0].geometry.polyname = "testname";
                    //localStorage.setItem('geoData', JSON.stringify(json));
                    
                    for (var i = 0; i < json.features.length; i++) {
                        
                        if(data !== undefined){
                            //alert("iii -- "+i);
                            
                            //alert("iii json -- "+json.features[i].geometry.polyname);
                            //alert("iii data -- "+JSON.stringify(data));
                            //alert("iii data features -- "+JSON.stringify(data.features[i]));
                            //alert("iii data f geo -- "+JSON.stringify(data.features[i].geometry));
                            
                                if(data.features[i] === undefined){
                                    /*if(json.features[i].geometry.polyname === undefined){
                                        polyname = prompt("Enter polygon name1:", "");
                                        }
                                        else{
                                            polyname = json.features[i].geometry.polyname;
                                        }*/
                                  }
                                  else{
                                      //alert("inhere");
                                      json.features[i].geometry.polyname = data.features[i].geometry.polyname;
                                  }
                               
                                //alert("-------- "+json.features[i].geometry.coordinates);
                                
                            //json.features[i].geometry.polyname = data.features[i].geometry.polyname;
                            
                        }
                        
                        //alert("--------2  "+JSON.stringify(json.features[i].geometry));
                         
                        if(json.features[i].geometry.polyname === undefined){

                            polyname = prompt("请输入电子栏杆区域名:", "");
                            }
                            else{
                                polyname = json.features[i].geometry.polyname;
                        }
                        
                        
                        //json.features[i].geometry.polyname = data.features[i].geometry.polyname;
                        
                        //polyname = json.features[i].geometry.polyname;
                        coord = json.features[i].geometry.coordinates;
                        features.push({"type":"Feature","geometry":{"type":"Polygon","coordinates":coord,"polyname":polyname},"properties":{}});
                    }
                    
                    var jsonstring = {"type":"FeatureCollection","features":features};
                    console.log("jsonstring-- "+JSON.stringify(jsonstring));
                    //localStorage.setItem('geoData', JSON.stringify(jsonstring));
                    document.getElementById("map_string").value = JSON.stringify(jsonstring);
                    $("#confirm_btn").click();
                    initControls(jsonstring);
                    
                });
            }
            
            function initControls(data)
            {
                
                var sel = document.getElementById('polyList');
                sel.options.length = 0;
                console.log("savepolygon22-- "+JSON.stringify(data));

                for (var i = 0; i < data.features.length; i++) {
                    var opt = document.createElement('option');
                    opt.innerHTML = data.features[i].geometry.polyname;
                    opt.value = i;
                    sel.appendChild(opt);
                }
                
                document.getElementById("btnDelete").disabled = (data.features.length === 0); 
                document.getElementById("btnDelete").onclick = function(){
                    var selIdx = sel.options[sel.selectedIndex].value; //get poly index 
                    data.features.splice(parseInt(selIdx), 1);   

                    //reload 
                    //localStorage.setItem('geoData', JSON.stringify(data));
                    document.getElementById("map_string").value = JSON.stringify(data);
                    $("#confirm_btn").click();
                    initControls(data);  
                    loadPolygons();
                    //window.location.reload();
                };
                
            }
           
    
    //}
    };
    
    
script.
    var runMapsGoogle = function() {
       
    //if (navigator.geolocation) {
        //navigator.geolocation.getCurrentPosition(function(position) {
            var data;
            map_g = new google.maps.Map(document.getElementById('googleMap'), {
                center: {
                    //lat: position.coords.latitude,
                    //lng: position.coords.longitude
                    lat: 23.1253491,
                    lng: 112.9469622
                },
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: false
            });
            
            
            map_g.data.setControls(['Polygon']);
            
            bindDataLayerListeners(map_g.data);
            
            loadPolygons();  //load saved data
            
            function bindDataLayerListeners(dataLayer) {
                dataLayer.addListener('addfeature', savePolygon);
                dataLayer.addListener('removefeature', savePolygon);
                //dataLayer.addListener('setgeometry', savePolygon);
            }

            

        //});
        function loadPolygons() {
                //var data = JSON.parse(localStorage.getItem('geoData'));
                data = JSON.parse(document.getElementById("map_string").value) ;
                //alert("llll-- "+JSON.stringify(data));
                map_g.data.forEach(function (f) {
                    map_g.data.remove(f);
                });
                map_g.data.addGeoJson(data);
            }

            function savePolygon() {
                //alert("mapp11-- "+map_g.data);
                
                //var polyname = prompt("Enter polygon name:", "");
                 var coord;
                 var features = [];
                 var polyname;
                
                 /*if(data !== undefined){
                    for (var i = 0; i < data.features.length; i++) {
                        alert("--------1 "+JSON.stringify(data.features[i].geometry));
                        //alert("-------- "+json.features[i].geometry.coordinates);
                        //polyname = data.features[i].geometry.polyname;
                        
                        polyname = data.features[i].geometry.polyname;
                        
                        coord = data.features[i].geometry.coordinates;
                        features.push({"type":"Feature","geometry":{"type":"Polygon","coordinates":coord,"polyname":polyname},"properties":{}});
                    }
                }*/
                 //map.bindPopup("<div>This is a polygon</div>" + polygonPopUpButtons);
                map_g.data.toGeoJson(function (json) {
                    //alert("sjon -- "+JSON.stringify(json));
                    //alert("sdata -- "+JSON.stringify(data));
                    //alert("sjon -- "+JSON.stringify(data));
                    //json.features[0].geometry.polyname = "testname";
                    //localStorage.setItem('geoData', JSON.stringify(json));
                    
                    for (var i = 0; i < json.features.length; i++) {
                        
                        if(data !== undefined){
                            //alert("iii -- "+i);
                            
                            //alert("iii json -- "+json.features[i].geometry.polyname);
                            //alert("iii data -- "+JSON.stringify(data));
                            //alert("iii data features -- "+JSON.stringify(data.features[i]));
                            //alert("iii data f geo -- "+JSON.stringify(data.features[i].geometry));
                            
                                if(data.features[i] === undefined){
                                    /*if(json.features[i].geometry.polyname === undefined){
                                        polyname = prompt("Enter polygon name1:", "");
                                        }
                                        else{
                                            polyname = json.features[i].geometry.polyname;
                                        }*/
                                  }
                                  else{
                                      //alert("inhere");
                                      json.features[i].geometry.polyname = data.features[i].geometry.polyname;
                                  }
                               
                                //alert("-------- "+json.features[i].geometry.coordinates);
                                
                            //json.features[i].geometry.polyname = data.features[i].geometry.polyname;
                            
                        }
                        
                        //alert("--------2  "+JSON.stringify(json.features[i].geometry));
                         
                        if(json.features[i].geometry.polyname === undefined){

                            polyname = prompt("请输入电子栏杆区域名:", "");
                            }
                            else{
                                polyname = json.features[i].geometry.polyname;
                            }
                        
                        //json.features[i].geometry.polyname = data.features[i].geometry.polyname;
                        
                        //polyname = json.features[i].geometry.polyname;
                        coord = json.features[i].geometry.coordinates;
                        features.push({"type":"Feature","geometry":{"type":"Polygon","coordinates":coord,"polyname":polyname},"properties":{}});
                    }
                    
                    var jsonstring = {"type":"FeatureCollection","features":features};
                    console.log("jsonstring-- "+JSON.stringify(jsonstring));
                    //localStorage.setItem('geoData', JSON.stringify(jsonstring));
                    document.getElementById("map_string").value = JSON.stringify(jsonstring);
                    $("#confirm_btn").click();
                    initControls(jsonstring);
                    
                });
            }
            
            function initControls(data)
            {
                var sel = document.getElementById('polyList');
                sel.options.length = 0;
                console.log("savepolygon22-- "+JSON.stringify(data));

                for (var i = 0; i < data.features.length; i++) {
                    var opt = document.createElement('option');
                    opt.innerHTML = data.features[i].geometry.polyname;
                    opt.value = i;
                    sel.appendChild(opt);
                }
                
                document.getElementById("btnDelete").disabled = (data.features.length === 0); 
                document.getElementById("btnDelete").onclick = function(){
                    var selIdx = sel.options[sel.selectedIndex].value; //get poly index 
                    data.features.splice(parseInt(selIdx), 1);   

                    //reload 
                    //localStorage.setItem('geoData', JSON.stringify(data));
                    document.getElementById("map_string").value = JSON.stringify(data);
                    $("#confirm_btn").click();
                    initControls(data);  
                    loadPolygons();
                    //window.location.reload();
                };
                
            }
           
    
    //}
    };
    
    var runMaps = function() {
       
            // 百度地图API功能
            var map_geo = new BMap.Map('baidu_geo');
            var poi = new BMap.Point(112.9469622,23.1253491);
            map_geo.centerAndZoom(poi, 10);
            map_geo.enableScrollWheelZoom();  
            var overlays = [];
                var overlaycomplete = function(e){
                overlays.push(e.overlay);
            };
            var styleOptions = {
                strokeColor:"blue",    //边线颜色。
                fillColor:"blue",      //填充颜色。当参数为空时，圆形将没有填充效果。
                strokeWeight: 2,       //边线的宽度，以像素为单位。
                strokeOpacity: 0.8,	   //边线透明度，取值范围0 - 1。
                fillOpacity: 0.5,      //填充的透明度，取值范围0 - 1。
                strokeStyle: 'solid' //边线的样式，solid或dashed。
            }
            //实例化鼠标绘制工具
            var drawingManager = new BMapLib.DrawingManager(map_geo, {
                drawingType: BMAP_DRAWING_POLYGON,
                isOpen: false, //是否开启绘制模式
                enableDrawingTool: true, //是否显示工具栏
                drawingToolOptions: {
                    anchor: BMAP_ANCHOR_TOP_RIGHT, //位置
                    offset: new BMap.Size(5, 5), //偏离值
                    drawingModes : [
                    BMAP_DRAWING_POLYGON 
                    ]
                },
                
                polygonOptions: styleOptions
            });  
            drawingManager.setDrawingMode(BMAP_DRAWING_POLYGON);
                 //添加鼠标绘制工具监听事件，用于获取绘制结果
            drawingManager.addEventListener('overlaycomplete', overlaycomplete);
            function clearAll() {
                        for(var i = 0; i < overlays.length; i++){
                    map_geo.removeOverlay(overlays[i]);
                }
                overlays.length = 0   
            }


            };
    
script.
    function clearMap() {
       
       for(var l=0;l<maps.length;l++){
           maps[l].eachLayer(function (layer) {
                //maps[l].removeLayer(markers[l]);
                maps[l].removeLayer(marks[l]);
                markers[l].clearLayers();

            });

      }
    }
    
    function clearMapPlayback() {
        //alert("nnn");
       for(var l=0;l<maps.length;l++){
           //alert("kkk");
          /* maps[l].eachLayer(function (layer) {
               //alert("ll");
               //alert("1");
               //alert(maps[l].hasLayer(markers_play[l]));
               //alert("2");
               /*maps[l].removeLayer();
               if(maps[l].hasLayer(polylinesPlayback)){
                   alert("has layer");
                //maps[l].removeLayer(polylinesPlayback);
                //markers_play[l].clearLayers();
                //maps[l].removeLayer(polylinesPlayback);
               }
               else{
                   alert("no layer");
               }
                //markers_play[l].clearLayers();
               //maps[l].removeLayer(polylinesPlayback); 
               //maps[l].removeLayer(myMovingMarker);
               alert(objToString(layer._map));
             
            });*/
            
        for(i in maps[l]._layers) {
            //maps[l].removeLayer(myMovingMarker); 
            //alert("maptoadd--"+maps[l]._layers[i].options.format);
            //alert("map--"+maps[l]._layers[i]);
            /*if(maps[l]._layers[i]._url !== undefined) {
               try {
                alert(objToString(maps[l]._layers[i]._icon);
                }
                catch(e){
                    
                }
            }*/
                
               
                //alert("af path");
                if (maps[l]._layers[i]._durations == 5000 || maps[l]._layers[i]._path !== undefined) {
                    try {
                        //alert(objToString(maps[l]._layers[i]._durations));
                        maps[l].removeLayer(maps[l]._layers[i]);
                        
                    } catch (e) {
                        alert("problem with " + e + map._layers[i]);
                    }
                }
                //alert("af dur");
                
                /*if (maps[l]._layers[i].options.format == undefined) {
                    try {
                        alert(objToString(maps[l]._layers[i]._durations));
                        maps[l].removeLayer(maps[l]._layers[i]);
                    } catch (e) {
                        console.log("problem with " + e + map._layers[i]);
                    }
                }*/
            
            //maps[l].removeLayer(myMovingMarker);
            
        }
      }
    }
    
script.
    function refresh() {
       window.location.reload();
    }
    
    function objToString (obj) {
    var str = '';
    for (var p in obj) {
        if (obj.hasOwnProperty(p)) {
            str += p + '::' + obj[p] + '\n';
        }
    }
    return str;
    }

script.
    function tracking(checkboxElem) {
        $('.subject-list').on('change', function() {
            $('.subject-list').not(this).prop('checked', false);  
        });
       var html='';
       var pointlist = [];
        
        if (checkboxElem.checked) {
            //alert(dd.length);
            //alert(dd[0].employee_location);
            for(var h=0;h<dd.length;h++){ 
                //document.getElementById("wizard_steps").innerHTML = '';
                clearMap();
                pointlist = [];
                //markers.clearLayers();
            }
            
            var emp_id = checkboxElem.value;
            document.getElementById('mission_list').href='/employee_details/'+emp_id;
            var positioning = JSON.parse(laodPositioning());
            var floorplan_a = JSON.parse(loadFloorPlan());
            for(var g=0;g<floorplan_a.length;g++){
                var floorplan_list = [];
                var floorplan = floorplan_a[g].markers;
                var ff = JSON.parse(floorplan);
                floorplan_list.push(ff);
                marker = JSON.parse(floorplan);
            for(var i=0;i<positioning.length;i++){
                var num = positioning[i].employee_id.toString();
                  var d = new Date(positioning[i].employee_time);
                  //d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                  var ddate = d.getDate();
                  var dmonth = d.getMonth()+1;
                  var dyear = d.getFullYear();
                  var dhour = d.getHours();
                  var dminutes = d.getMinutes();
                  var dseconds = d.getSeconds();
                 
                  if(ddate < 10){
                      ddate = "0"+ddate;
                  }
                  if(dmonth < 10){
                      dmonth = "0"+dmonth;
                  }

                  if(dhour < 10){
                      dhour = "0"+dhour;
                  }
                  if(dminutes < 10){
                      dminutes = "0"+dminutes;
                  }
                  if(dseconds < 10){
                      dseconds = "0"+dseconds;
                  }

                  var mfloors = JSON.parse(floors);
                  //alert(mfloors.floor[0].floor_id);
                  mhuman = floorplan_list;
                  for(var j=0;j<maps.length;j++){
                  for (k in mhuman[j]) {
                  var newdate = ddate+"/"+dmonth+"/"+dyear+" "+dhour+":"+dminutes+":"+dseconds;
                  //console.log("num--- "+num);
                  //console.log("emp_id--- "+emp_id);
                  //console.log("dd["+i+"].location_id--- "+dd[i].location_id);
                  //console.log("mhuman["+k+"].popup--- "+mhuman[k].popup);
                if(num === emp_id){
                    
                      man = {
                          x: mhuman[j][k].latlngs.lat,
                          y: mhuman[j][k].latlngs.lng
                        };

                      human1 = L.divIcon({
                          className: 'checkpoint-pin',
                          html: '<img src="/images/man.png"/><p style="color:black;">'+dd[i].employee_name+' ('+newdate+')</p>',
                          iconSize: [15, 15],
                          iconAnchor: [10, 10]
                        });

                    //alert(emp_id+"---"+dd[i].employee_id+"---"+mhuman[j][k].popup+"---"+dd[i].location_id);
                   
                    if(positioning[i].employee_location === mhuman[j][k].popup){
                        //alert(j);
                        console.log(positioning[i].employee_location+" -- "+mhuman[j][k].popup);
                        //var random = Math.floor(Math.random() * 10) + 1; 
                        //console.log("random--"+random);
                        //alert("in 1 i="+i+" k="+k);
                          var marker = L.marker([man.x, man.y], {
                            icon: human1
                          });
                          
                          markers[g].bindTooltip(positioning[i].employee_name,{direction:'bottom'}).addLayer(marker);
                          pointlist.push([man.x, man.y]);
                          //console.log("pointlist11--"+pointlist);
                          //drawPolyline();
                          
                          //html += '<li><a href="#step-1"><span class="step_no">'+dd[i].employee_location+'</span><span class="step_descr">'+dd[i].employee_id+'<br/><small>'+newdate+'</small></span></a></li>';
                          
                          document.getElementById(mfloors.floor[g].floor_id).click();
                          //alert(mfloors.floor[i].floor_id);
                          maps[g].addLayer(markers[g]);
                          //document.getElementById("wizard_steps").innerHTML = html;
                        
                          /*L.polyline(pointlist, {
                                color: 'red',
                                weight: 3,
                                opacity: 0.5,
                                smoothFactor: 1
                            }).addTo(maps[j]);*/
                    }

                    }

                  }
     
            }
            }
            }
                
        } else {

            for(var i=0;i<maps.length;i++){ 
                
                //document.getElementById("wizard_steps").innerHTML = '';
                clearMap();
                pointlist = [];
                //markers.clearLayers();
                
            }

        }
      }

script.
    function showAll(checkboxElem) {
        $('.subject-list').on('change', function() {
            $('.subject-list').not(this).prop('checked', false);  
        });
       var html='';
       var pointlist = [];
        
        if (checkboxElem.checked) {
            //alert(dd.length);
            //alert(dd[0].employee_location);
            for(var h=0;h<dd.length;h++){ 
                //document.getElementById("wizard_steps").innerHTML = '';
                clearMap();
                pointlist = [];
                //markers.clearLayers();
                
            }
            
            
            var emp_id = checkboxElem.value;
            var positioning = JSON.parse(laodPositioning());
            for(var i=0;i<positioning.length;i++){
                var num = positioning[i].employee_id.toString();
                var name = positioning[i].employee_name.toString();
                var d = new Date(positioning[i].employee_time);
                  //d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                var ddate = d.getDate();
                var dmonth = d.getMonth()+1;
                var dyear = d.getFullYear();
                var dhour = d.getHours();
                var dminutes = d.getMinutes();
                var dseconds = d.getSeconds();

                if(ddate < 10){
                    ddate = "0"+ddate;
                }
                if(dmonth < 10){
                    dmonth = "0"+dmonth;
                }

                if(dhour < 10){
                    dhour = "0"+dhour;
                }
                if(dminutes < 10){
                    dminutes = "0"+dminutes;
                }
                if(dseconds < 10){
                    dseconds = "0"+dseconds;
                }

                var mfloors = JSON.parse(floors);
                mhuman = floorplan_list;
                for(var j=0;j<maps.length;j++){
                for (k in mhuman[j]) {
                var newdate = ddate+"/"+dmonth+"/"+dyear+" "+dhour+":"+dminutes+":"+dseconds;

                man = {
                    x: mhuman[j][k].latlngs.lat,
                    y: mhuman[j][k].latlngs.lng
                  };

                human1 = L.divIcon({
                    className: 'checkpoint-pin',
                    html: '<img src="/images/man.png"/><p style="color:black;">'+dd[i].employee_name+' ('+newdate+')</p>',
                    iconSize: [15, 15],
                    iconAnchor: [10, 10]
                  });

                if(positioning[i].employee_location === mhuman[j][k].popup){

                      var marker = L.marker([man.x, man.y], {
                        icon: human1
                      });

                markers[j].addLayer(marker);

                maps[j].addLayer(markers[j]);
                }

                }
            }
            }

        } else {

            for(var i=0;i<maps.length;i++){ 
                
                //document.getElementById("wizard_steps").innerHTML = '';
                clearMap();
                pointlist = [];
                //markers.clearLayers();
                
            }

        }
      }
    
script.
    var checkboxValue = '';
    
    function setCheckboxValue(val){
        checkboxValue = val;
    }
    
    function getCheckboxValue(){
        return checkboxValue;
    }
    function checkBoxSingle(checkboxElem){
        $('.subject-list').on('change', function() {
            $('.subject-list').not(this).prop('checked', false);
        });
        
        setCheckboxValue(checkboxElem.value);
    }
    
    function activaTab(tab){
    $('.nav-tabs a:first').tab('show')
        };
script.
    var myMovingMarker = {};
    function doalert() {
     
       //alert("1");
       var html='';
       var pointlist = [];
       var polylines;
       var polylinesPlayback;
       
       var time1 = document.getElementById('time1').value;
       var time2 = document.getElementById("time2").value;
       //var emp_id = getCheckboxValue();
       var checks = $('#tree_indoor_playback').treeview('getSelected', '1');
       //alert("sss--"+JSON.stringify(checks));
       //alert(checks[0].emp_id);
       var emp_id = checks[0].emp_id.toString();
        
        var positioning = JSON.parse(loadHistoryNew(time1,time2,emp_id));
        var floorplan_a = JSON.parse(loadFloorPlan());
        
       //alert("2");
        if(positioning.length === 0){
            alert("没有找到记录!");
        }
         
        if (emp_id !== null) {
            //alert("31");
            clearMapPlayback();
            //alert("331");
            for(var g=0;g<floorplan_a.length;g++){
                document.getElementById("wizard_steps").innerHTML = '';
                //alert("41");
                clearMapPlayback();
                pointlist = [];
                //markers[h].clearLayers();
                }
            
            
            //alert("5");
            for(var g=0;g<floorplan_a.length;g++){
                var test = [];
                var loc1 = [];
                var loc2 = [];
                var sorted = [];
                var sorted_loc1 = [];
                var sorted_loc2 = [];
                var sorted_loc_list = [];
       
                var floorplan_list = [];
                var floorplan = floorplan_a[g].markers;
                var ff = JSON.parse(floorplan);
                floorplan_list.push(ff);
                marker = JSON.parse(floorplan);
                //alert("6");
                
            for(var i=0;i<positioning.length;i++){
                var num = positioning[i].employee_id.toString();
                //alert("7");
                  var d = new Date(positioning[i].path_datetime);
                  //d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                  var ddate = d.getDate();
                  var dmonth = d.getMonth()+1;
                  var dyear = d.getFullYear();
                  var dhour = d.getHours();
                  var dminutes = d.getMinutes();
                  var dseconds = d.getSeconds();
                  
                  if(ddate < 10){
                      ddate = "0"+ddate;
                  }
                  if(dmonth < 10){
                      dmonth = "0"+dmonth;
                  }

                  if(dhour < 10){
                      dhour = "0"+dhour;
                  }
                  if(dminutes < 10){
                      dminutes = "0"+dminutes;
                  }
                  if(dseconds < 10){
                      dseconds = "0"+dseconds;
                  }

                  
                  //mhuman = JSON.parse(floorplan);
                  //alert("floorplan_list-- "+floorplan_list);
                  var mfloors = JSON.parse(floors);
                  //alert("floors-- "+mfloors);
                  mhuman = floorplan_list;
                  for(var j=0;j<maps.length;j++){
                      
                  for (k in mhuman[j]) {
                      
                  var newdate = ddate+"/"+dmonth+"/"+dyear+" "+dhour+":"+dminutes+":"+dseconds;

                if(num === emp_id){
                    
                      man = {
                          x: mhuman[j][k].latlngs.lat,
                          y: mhuman[j][k].latlngs.lng
                        };

                      pointlist.push([man.x, man.y]);
                      //alert(pointlist);
                    //alert(emp_id+"---"+dd[i].employee_id+"---"+mhuman[j][k].popup+"---"+dd[i].location_id);
                    if(positioning[i].location_id === mhuman[j][k].popup){   
                        test.push(mhuman[j][k].popup);
                        loc1.push(mhuman[j][k].latlngs.lat);
                        loc2.push(mhuman[j][k].latlngs.lng);
                        
                        sorted = test.filter(onlyUnique);
                        sorted_loc1 = loc1.filter(onlyUnique);
                        sorted_loc2 = loc2.filter(onlyUnique);
                        //alert("s="+sorted+" l1="+sorted_loc1+" l2="+sorted_loc2);
                        html += '<li><a href="#step-1"><span class="step_no">'+positioning[i].location_id+'</span><span class="step_descr">'+positioning[i].employee_id+'<br/><small>'+newdate+'</small></span></a></li>';
                        document.getElementById(mfloors.floor[j].floor_id).click();
                        document.getElementById("wizard_steps").innerHTML = html; 
                        sorted_loc_list.push([mhuman[j][k].latlngs.lat, mhuman[j][k].latlngs.lng]);
                        }

                    }

                  }

            } 
        }
            
            //for(var jk=0;jk<maps.length;jk++){
                human1 = L.divIcon({
                          className: 'checkpoint-pin',
                          html: '<img src="/images/man.png">',
                          iconSize: [20, 20],
                          iconAnchor: [10, 10]
                        });
                var myIcon = L.icon({
                    iconUrl: '/images/man.png',
                    iconSize: [40, 40],
                    iconAnchor: [10, 10]
                  });

                        
            //alert("s="+sorted+" l1="+sorted_loc1+" l2="+sorted_loc2+" leh="+sorted.length);
                  /*for(var gk=0;gk<sorted.length;gk++){
                    var marker = L.marker([sorted_loc1[gk], sorted_loc2[gk]], {
                                icon: human1
                              });
                             
                             //markers_play[g].addLayer(marker);
                             //maps[g].addLayer(markers_play[g]);
                }*/
                
                //alert(sorted_loc_list);
                //alert("8");
                myMovingMarker = L.Marker.movingMarker(sorted_loc_list,[5000]);
                myMovingMarker.options.icon = myIcon;
                myMovingMarker.addTo(maps[g]);
                myMovingMarker.start();
                polylinesPlayback = L.polyline(sorted_loc_list, {color: 'red'});
                polylinesPlayback.addTo(maps[g]);
                 
                //alert("9");
                //document.getElementById("playIndoor").onclick = clickIndoor(myMovingMarker);
                document.getElementById('playIndoor').addEventListener('click', function() {
                    this.myMovingMarker.start();
                    this.L.Marker.MovingMarker.clearLayers(this, maps[g]);
                    //this.L.Marker.MovingMarker = null;
                    }, false);
                /*document.getElementById("playIndoor").onclick = function(myMovingMarker){
                    alert(myMovingMarker);
                    myMovingMarker.start();
                    alert("in 2");
                };*/
                
                
            //}
            }
        } else {

            for(var i=0;i<maps.length;i++){ 
                //alert("10");
                document.getElementById("wizard_steps").innerHTML = '';
                clearMapPlayback();
                pointlist = [];
                maps[i].removeLayer(polylines);
                //markers.clearLayers();
                
            }

        }
      }
      
    function onlyUnique(value, index, self) { 
        return self.indexOf(value) === index;
        }
        
    function clickIndoor(sorted_loc_list,maps) {
        
        var myIcon = L.icon({
                    iconUrl: '/images/man.png',
                    iconSize: [40, 40],
                    iconAnchor: [10, 10]
                  });
        //alert("1");
        var myMovingMarker = L.Marker.movingMarker(sorted_loc_list,[5000]);
        //alert("2");
        myMovingMarker.options.icon = myIcon;
        //alert("3");
        myMovingMarker.addTo(maps);
        //alert("4");
        myMovingMarker.start();
        //alert("5");
        L.polyline(sorted_loc_list, {color: 'red'}).addTo(maps);
        //alert("6");
       
        }
        
script.
    function playbackOutdoor() {
       
       var html='';
       var pointlist = [];
       var polylines;
       var checks = $('#tree_outdoor').treeview('getSelected', '1');
       //alert(JSON.stringify(checks));
       //alert(checks[0].emp_id);
       
       var time1 = document.getElementById('time1').value;
       var time2 = document.getElementById("time2").value;
       //var emp_id = getCheckboxValue();
       var emp_id = checks[0].emp_id;
      
        var data_p = JSON.parse(loadHistoryGps(time1,time2,emp_id));
        
        if(data_p.length === 0){
            alert("没有找到记录!");
        }
            
            var contentString = [];
            
            for(var i=0;i<data_p.length;i++){
                var d = new Date(data_p[i].employee_time);
            //    d.setMinutes(d.getMinutes()+480);
                //d.setMinutes(d.getMinutes()-480);
                var ddate = d.getDate();
                var dmonth = d.getMonth()+1;
                var dyear = d.getFullYear();
                var dhour = d.getHours();
                var dminutes = d.getMinutes();
                var dseconds = d.getSeconds();
                

                if(ddate < 10){
                    ddate = "0"+ddate;
                }
                if(dmonth < 10){
                    dmonth = "0"+dmonth;
                }

                if(dhour < 10){
                    dhour = "0"+dhour;
                }
                if(dminutes < 10){
                    dminutes = "0"+dminutes;
                }
                if(dseconds < 10){
                    dseconds = "0"+dseconds;
                }

                var newdate;
                newdate = dyear+"-"+dmonth+"-"+ddate+" "+dhour+":"+dminutes+":"+dseconds;
                var partsOfStr = data_p[i].gps_loc.split(',');
                //alert(partsOfStr);
                contentString[i] = '<ul class="list-unstyled">'+
                        '<li class="media event">'+
                            '<a class="pull-left">'+
                              '<img src="/'+data_p[i].employee_image+'" height="40" width="40">'+
                            '</a>'+
                            '<div class="media-body">'+
                              '<a class="title" href="#">'+data_p[i].employee_name+'</a>'+
                              '<p>最后的位置: '+newdate+'</p>'+
                              '</p>'+
                            '</div>'+
                          '</li></ul>';
                
                var myLatLng = {lat: parseFloat(partsOfStr[1] - 0.00575), lng: parseFloat(partsOfStr[0] - 0.00668)};
                //flightPlanCoordinates.push(new google.maps.LatLng(parseFloat(partsOfStr[1] - 0.00575), parseFloat(partsOfStr[0] - 0.00668)));
                flightPlanCoordinates.push(new BMap.Point(partsOfStr[0], partsOfStr[1]));   
            }
            
            
            //To obtain a route through the DrivingRoute point
            var driving = new BMap.DrivingRoute(map_baidu);
            driving.search(flightPlanCoordinates[0], flightPlanCoordinates[data_p.length - 1]);
            driving.setSearchCompleteCallback(function() {
            //Get all the point route
            //points = driving.getResults().getPlan(0).getRoute(0).getPath();
            //The picture to move to the middle of the beginning and the end
            centerPoint = new BMap.Point((flightPlanCoordinates[0].lng + flightPlanCoordinates[flightPlanCoordinates.length - 1].lng) / 2, (flightPlanCoordinates[0].lat + flightPlanCoordinates[flightPlanCoordinates.length - 1].lat) / 2);
            map_baidu.panTo(centerPoint);
            //Connect all the dots
            map_baidu.addOverlay(new BMap.Polyline(flightPlanCoordinates, {strokeColor: "black", strokeWeight: 5, strokeOpacity: 1}));
            });
            
            label = new BMap.Label("", {offset: new BMap.Size(-20, -20)});
            car = new BMap.Marker(flightPlanCoordinates[0]);
            car.setLabel(label);
            map_baidu.addOverlay(car);

            
            document.getElementById("playButton").onclick = function(){
                //animateCircle(flightPath);
                play();
                };
            document.getElementById("pauseButton").onclick = function(){
                //animateCircle(flightPath);
                pause();
                };
            document.getElementById("stopButton").onclick = function(){
                //animateCircle(flightPath);
                reset();
                };
            
            
      }
//    function playbackOutdoor() {
//       var html='';
//       var pointlist = [];
//       var polylines;
//       var checks = $('#tree_outdoor').treeview('getSelected', '1');
//       //alert(JSON.stringify(checks));
//       //alert(checks[0].emp_id);
//       
//       var time1 = document.getElementById('time1').value;
//       var time2 = document.getElementById("time2").value;
//       //var emp_id = getCheckboxValue();
//       var emp_id = checks[0].emp_id;
//      
//        var data_p = JSON.parse(loadHistoryGps(time1,time2,emp_id));
//        
//        if(data_p.length === 0){
//            alert("没有找到记录!");
//        }
//         
//            var contentString = [];
//            var flightPlanCoordinates = [];
//            for(var i=0;i<data_p.length;i++){
//                var d = new Date(data_p[i].employee_time);
//            //    d.setMinutes(d.getMinutes()+480);
//                //d.setMinutes(d.getMinutes()-480);
//                var ddate = d.getDate();
//                var dmonth = d.getMonth()+1;
//                var dyear = d.getFullYear();
//                var dhour = d.getHours();
//                var dminutes = d.getMinutes();
//                var dseconds = d.getSeconds();
//
//
//                if(ddate < 10){
//                    ddate = "0"+ddate;
//                }
//                if(dmonth < 10){
//                    dmonth = "0"+dmonth;
//                }
//
//                if(dhour < 10){
//                    dhour = "0"+dhour;
//                }
//                if(dminutes < 10){
//                    dminutes = "0"+dminutes;
//                }
//                if(dseconds < 10){
//                    dseconds = "0"+dseconds;
//                }
//
//                var newdate;
//                newdate = dyear+"-"+dmonth+"-"+ddate+" "+dhour+":"+dminutes+":"+dseconds;
//                var partsOfStr = data_p[i].gps_loc.split(',');
//                //alert(partsOfStr);
//                contentString[i] = '<ul class="list-unstyled">'+
//                        '<li class="media event">'+
//                            '<a class="pull-left">'+
//                              '<img src="/'+data_p[i].employee_image+'" height="40" width="40">'+
//                            '</a>'+
//                            '<div class="media-body">'+
//                              '<a class="title" href="#">'+data_p[i].employee_name+'</a>'+
//                              '<p>最后的位置: '+newdate+'</p>'+
//                              '</p>'+
//                            '</div>'+
//                          '</li></ul>';
//                
//                var myLatLng = {lat: parseFloat(partsOfStr[1] - 0.00575), lng: parseFloat(partsOfStr[0] - 0.00668)};
//                flightPlanCoordinates.push(new google.maps.LatLng(parseFloat(partsOfStr[1] - 0.00575), parseFloat(partsOfStr[0] - 0.00668)))
//                //alert(myLatLng);
//                /*marker_g[i] = new google.maps.Marker({
//                    position: myLatLng,
//                    icon: '/images/man2_1.png',
//                    map: map_g,
//                    label: data_p[i].employee_name
//                    });
//
//                   google.maps.event.addListener(marker_g[i], 'click', (function(marker, i) {
//                    return function() {
//                        infoWindow.setContent(contentString[i]);
//                        infoWindow.open(map_g, marker_g[i]);
//                    }
//                })(marker_g[i], i));
//                
//                marker_g[i].setMap(map_g); */
//                
//            }
//            //map_g.data.setControls(['Polygon']);
//            map_g.setZoom(10);
//            map_g.setCenter(flightPlanCoordinates[0]);
//            var lineSymbol = {
//                path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
//                scale: 5,
//                strokeColor: '#393'
//              };
//        
//            var flightPath = new google.maps.Polyline({
//                path: flightPlanCoordinates,
//                icons: [{
//                    icon: lineSymbol,
//                    offset: '0%'
//                  }],
//                map: map_g
//              });
//              
//            //flightPath.setMap(map_g);
//            
//            document.getElementById("playButton").onclick = function(){
//                animateCircle(flightPath);
//                };
//            
//            
//      }
        
script.
    function animateCircle(line) {
          var count = 0;
          var inter = setInterval(function() {
            count = (count + 1) % 200;

            var icons = line.get('icons');
            var off = (count / 2) + '%';
            if(off !== '0%'){
                icons[0].offset = off;
                line.set('icons', icons);
            }
            else{
                clearInterval(inter);
            }
        }, 100);
        
      }
      
    function play() {
        var point = flightPlanCoordinates[index];
        if(index > 0) {
        map_baidu.addOverlay(new BMap.Polyline([flightPlanCoordinates[index - 1], point], {strokeColor: "black", strokeWeight: 1, strokeOpacity: 1}));
        }
        car.setPosition(point);
        index++;
        
        
        if(index <flightPlanCoordinates.length) {
            
        timer = window.setTimeout("play(" + index + ")", 200);
        } else {
        
        map_baidu.panTo(point);
        }
        
        }
        
    function pause() {
        if(timer) {
        window.clearTimeout(timer);
        }
        }
        
    function reset() {
       

        if(timer) {
        window.clearTimeout(timer);
        }
        index = 0;
        car.setPosition(points[0]);
        map_baidu.panTo(centerPoint);
        }
      
    var socket = io();
    socket.on('tracking', function(rows) {
        
        var language = rows.language;
        
        //clearMap();
        var employees = rows.employee;
        var floor_plan = rows.floor_plan;
        //var markers = [];
        
        var floors = rows.floors.replace(/&quot;/g, '"');
        for(var t=0;t<floor_plan.length;t++){
        var floorplan_list = [];
        
        //markers[t] = new L.FeatureGroup();
        var floorplan_id = floor_plan[t].floorplan_id;
        var floorplan = floor_plan[t].markers;
        var emp_no = 0;
        var emp_no_id = "no_emp"+floorplan_id;
        
        var ff = JSON.parse(floorplan);
        floorplan_list.push(ff);
        marker = JSON.parse(floorplan);
      for(var i=0;i<dd.length;i++){
          
                var num = dd[i].employee_id.toString();
                var name = dd[i].employee_name.toString();
                var d = new Date(dd[i].path_datetime);
                  //d.setMinutes(d.getMinutes()+d.getTimezoneOffset());
                var ddate = d.getDate();
                var dmonth = d.getMonth()+1;
                var dyear = d.getFullYear();
                var dhour = d.getHours();
                var dminutes = d.getMinutes();
                var dseconds = d.getSeconds();

                if(ddate < 10){
                    ddate = "0"+ddate;
                }
                if(dmonth < 10){
                    dmonth = "0"+dmonth;
                }

                if(dhour < 10){
                    dhour = "0"+dhour;
                }
                if(dminutes < 10){
                    dminutes = "0"+dminutes;
                }
                if(dseconds < 10){
                    dseconds = "0"+dseconds;
                }

                var mfloors = JSON.parse(floors);
                mhuman = floorplan_list;

                for(var j=0;j<maps.length;j++){
                for (k in mhuman[j]) {
                var newdate = ddate+"/"+dmonth+"/"+dyear+" "+dhour+":"+dminutes+":"+dseconds;
                
                var emp_loc_no = 0;
                if(dd[i].employee_location === mhuman[j][k].popup){
                emp_no++;
                emp_loc_no++;
                /*if (marker !== null && marker.length !== 0) {
                    for (h in marker) {
                    marks[i] = L.marker(marker[h].latlngs, marker[h].options).bindTooltip("<div><b>" + marker[h].popup + "</b>("+emp_loc_no+" 名员工)</div>",{direction:'top'});

                    maps[t].addLayer(marks[i]);

                    }
                    } else {
                    marker = [];
                    }*/
                }

                }
            }
            }
    
    if(language === 'en'){
    //document.getElementById(emp_no_id).innerHTML = "("+emp_no+" employee)";
    }
    else{
    //document.getElementById(emp_no_id).innerHTML = "("+emp_no+" 名员工)";  
    }
    }

    

    });
    
    socket.on('tracking_outdoor', function(rows) {
        
        map_baidu.clearOverlays();
        var language = rows.language;
        
        //clearMap();
        var employees = rows.employee;
        var building = rows.building;

        //alert("in 4");
    var contentString = [];
    var contentString2 = [];
    //alert("in6")
    for(var i=0;i<building.length;i++){
        
                var mystring = building[i].building_location.replace('(','');
                mystring = mystring.replace(')','');
                var partsOfStr = mystring.split(',');
        
                contentString[i] = [parseFloat(partsOfStr[1]),parseFloat(partsOfStr[0]),'<ul class="list-unstyled">'+
                        '<li class="media event">'+
                            '<a class="pull-left border-aero profile_thumb">'+
                              '<i class="fa fa-building aero"></i>'+
                            '</a>'+
                            '<div class="media-body">'+
                              '<a class="title" href="#">'+building[i].building_name+'</a>'+
                              '<p><b>地址:</b> '+building[i].building_add+'</p>'+
                            '</div>'+
                          '</li></ul>',building[i].building_name];
                
                
                 
                
                var pt = new BMap.Point(parseFloat(partsOfStr[1]), parseFloat(partsOfStr[0]));
                //alert(parseFloat(partsOfStr[1] + 0.00575)+","+ parseFloat(partsOfStr[0] + 0.00668));
                var myIcon = new BMap.Icon("/images/skyline.png", new BMap.Size(50,50));
                var marker3 = new BMap.Marker(pt,{icon:myIcon});  // 创建标注
                map_baidu.addOverlay(marker3); 
                var label = new BMap.Label(building[i].building_name,{offset:new BMap.Size(20,10)});
                label.setStyle({ borderColor: "#999", border:"0" });
                marker3.setLabel(label);
                //alert("afyer nuilding");
            }
            
            for(var i=0;i<contentString.length;i++){
                var myIcon = new BMap.Icon("/images/skyline.png", new BMap.Size(50,50));
                var marker = new BMap.Marker(new BMap.Point(contentString[i][0],contentString[i][1]),{icon:myIcon});  // 创建标注
                var content = contentString[i][2];
                var label = new BMap.Label(contentString[i][3],{offset:new BMap.Size(20,10)});
                label.setStyle({ borderColor: "#999", border:"0" });
                map_baidu.addOverlay(marker);           // 将标注添加到地图中
                marker.setLabel(label);
                addClickHandler(content,marker);
            }
            
            function addClickHandler(content,marker){
                    marker.addEventListener("click",function(e){
                            
                            openInfo(content,e);}
                    );
            }
            function openInfo(content,e){
                    var p = e.target;
                    var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                    var infoWindow = new BMap.InfoWindow(content);  // 创建信息窗口对象 
                    map_baidu.openInfoWindow(infoWindow,point); //开启信息窗口
            }
            
            
    for(var i=0;i<employees.length;i++){
        var d = new Date(employees[i].employee_time);
    //    d.setMinutes(d.getMinutes()+480);
        //d.setMinutes(d.getMinutes()-480);
        var ddate = d.getDate();
        var dmonth = d.getMonth()+1;
        var dyear = d.getFullYear();
        var dhour = d.getHours();
        var dminutes = d.getMinutes();
        var dseconds = d.getSeconds();
        

        if(ddate < 10){
            ddate = "0"+ddate;
        }
        if(dmonth < 10){
            dmonth = "0"+dmonth;
        }

        if(dhour < 10){
            dhour = "0"+dhour;
        }
        if(dminutes < 10){
            dminutes = "0"+dminutes;
        }
        if(dseconds < 10){
            dseconds = "0"+dseconds;
        }

        var newdate;
        newdate = dyear+"-"+dmonth+"-"+ddate+" "+dhour+":"+dminutes+":"+dseconds;
        
        var partsOfStr = employees[i].employee_gps.split(',');
                
                contentString2[i] = [parseFloat(partsOfStr[0] - 0.00668),parseFloat(partsOfStr[1] - 0.00575)'<ul class="list-unstyled">'+ 
                        '<li class="media event">'+
                            '<a class="pull-left">'+
                              '<img src="/'+employees[i].employee_image+'" height="40" width="40">'+
                            '</a>'+
                            '<div class="media-body">'+
                              '<a class="title" href="#">'+employees[i].employee_name+'</a>'+
                              '<p>最后的位置: '+newdate+'</p>'+
                              '</p>'+
                            '</div>'+
                          '</li></ul>',employees[i].employee_name];
                
                
                /*var myLatLng = {lat: parseFloat(partsOfStr[1] - 0.00575), lng: parseFloat(partsOfStr[0] - 0.00668)};
                //alert(myLatLng);
                marker_g[i] = new google.maps.Marker({
                    position: myLatLng,
                    icon: '/images/man2_1.png',
                    map: map_g,
                    label: employees[i].employee_name,
                    });
                    
                    google.maps.event.addListener(marker_g[i], 'click', (function(marker, i) {
                    return function() {
                        infoWindow.setContent(contentString[i]);
                        infoWindow.open(map_g, marker_g[i]);
                    }
                })(marker, i));
                
                marker_g[i].setMap(map_g);*/
                
                
            }
            
            for(var i=0;i<contentString2.length;i++){
                var myIcon = new BMap.Icon("/images/man2_1.png", new BMap.Size(50,50));
                var marker = new BMap.Marker(new BMap.Point(contentString2[i][0],contentString2[i][1]),{icon:myIcon});  // 创建标注
                var content = contentString2[i][2];
                var label = new BMap.Label(contentString2[i][3],{offset:new BMap.Size(20,10)});
                label.setStyle({ borderColor: "#999", border:"0" });
                map_baidu.addOverlay(marker);           // 将标注添加到地图中
                marker.setLabel(label);
                addClickHandler2(content,marker);
            }
            
            function addClickHandler2(content,marker){
                    marker.addEventListener("click",function(e){
                            
                            openInfo2(content,e);}
                    );
            }
            function openInfo2(content,e){
                    var p = e.target;
                    var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                    var infoWindow = new BMap.InfoWindow(content);  // 创建信息窗口对象 
                    map_baidu.openInfoWindow(infoWindow,point); //开启信息窗口
            }
    

    });
    
script.
    function laodPositioning()
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", "/get_positioning", false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
    
    function loadFloorPlan()
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", "/get_floorplan", false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
    
    function loadHistory()
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", "/get_history", false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
    
    function loadHistoryNew(time1,time2,emp_id)
    {
        time1 = time1+":00";
        time2 = time2+":59";
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", "/get_history/"+time1+"/"+time2+"/"+emp_id, false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
    
    function loadHistoryGps(time1,time2,emp_id)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", "/get_playback/"+time1+"/"+time2+"/"+emp_id, false ); // false for synchronous request
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }

    
    